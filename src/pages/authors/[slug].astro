---
import { getCollection } from 'astro:content'
import type { CollectionEntry } from 'astro:content'
import AuthorLayout from '../../layouts/AuthorLayout.astro'
import HeaderPremium from '../../components/HeaderPremium.astro';
import Footer from '../../components/Footer.astro';
// CSS included via BaseHead

// Enable static generation for this page
export const prerender = true;

export async function getStaticPaths() {
  const authors = await getCollection('authors')
  
  return authors.map((author: CollectionEntry<'authors'>) => ({
    params: { slug: author.slug },
    props: { author },
  }))
}

const { slug } = Astro.params
const { author } = Astro.props

// If author not found in props, try to fetch it
const authorData: CollectionEntry<'authors'> | undefined = author || (await getCollection('authors')).find((a: CollectionEntry<'authors'>) => a.slug === slug)

if (!authorData) {
  return Astro.redirect('/404')
}

// Get articles by this author
const allArticles = await getCollection('articles')
const articles = allArticles.filter((article: CollectionEntry<'articles'>) => article.data.author === authorData.data.name)

// Render the author's markdown content
const { Content } = await authorData.render()
---

<AuthorLayout author={authorData} articles={articles}>
	<Content />
</AuthorLayout>