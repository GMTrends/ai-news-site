---
import { getArticlesByCategory } from '../lib/sanity';
import { generateWebPUrl, generateResponsiveSrcSet } from '../utils/imageOptimization'
import CategorySidebar from './CategorySidebar.astro';
import BaseHead from './BaseHead.astro';
import Header from './Header.astro';
import Footer from './Footer.astro';
import { getCategoryUrl } from '../utils/urlHelpers';
import { HOMEPAGE_CATEGORIES } from '../consts.ts';

// Helper functions
function getArticleUrl(article: any) {
	const category = article.category?.slug?.current || 'marketing';
	const slug = article.slug?.current || article.slug;
	return `/${category}/${slug}`;
}

function formatDate(dateString: string) {
	return new Date(dateString).toLocaleDateString('en-US', { 
		month: 'short', 
		day: 'numeric' 
	})
}

// Fetch articles for each homepage category
const categoryArticles: Record<string, any[]> = {};
for (const category of HOMEPAGE_CATEGORIES) {
	categoryArticles[category.slug] = await getArticlesByCategory(category.slug, 8);
}

// Fallback data if no articles are found
const fallbacks = [
	{ data: { title: "Sample AI News Article", excerpt: "This is a sample article for demonstration.", category: "ai-news", author: "AI Expert", publishedAt: new Date().toISOString() }, slug: "sample-1" },
	{ data: { title: "Another AI Update", excerpt: "Another sample article for the grid.", category: "ai-news", author: "Tech Writer", publishedAt: new Date().toISOString() }, slug: "sample-2" },
	{ data: { title: "AI Technology Review", excerpt: "Review of latest AI technology.", category: "ai-news", author: "Reviewer", publishedAt: new Date().toISOString() }, slug: "sample-3" },
	{ data: { title: "Industry Analysis", excerpt: "Deep dive into AI industry trends.", category: "ai-news", author: "Analyst", publishedAt: new Date().toISOString() }, slug: "sample-4" },
	{ data: { title: "Tutorial Guide", excerpt: "How to implement AI solutions.", category: "ai-news", author: "Instructor", publishedAt: new Date().toISOString() }, slug: "sample-5" },
	{ data: { title: "Latest Updates", excerpt: "Recent developments in AI field.", category: "ai-news", author: "Reporter", publishedAt: new Date().toISOString() }, slug: "sample-6" },
	{ data: { title: "AI Agent Development Guide", excerpt: "Learn how to build and deploy intelligent AI agents for automation.", category: "ai-agents", author: "AI Developer", publishedAt: new Date().toISOString() }, slug: "ai-agent-guide" },
	{ data: { title: "Enterprise AI Agents", excerpt: "How businesses are leveraging AI agents to streamline operations.", category: "ai-agents", author: "Business Analyst", publishedAt: new Date().toISOString() }, slug: "enterprise-ai-agents" }
]

// Use fallback data if no articles are found
const finalArticles: Record<string, any[]> = {};
for (const category in categoryArticles) {
	finalArticles[category] = categoryArticles[category].length > 0 ? categoryArticles[category] : fallbacks.slice(0, 8);
}

// Get main articles for each section (4 articles each, except reviews which has 6 large cards)
const mainArticles: Record<string, any[]> = {};
for (const category in finalArticles) {
	mainArticles[category] = finalArticles[category].slice(0, 4);
}

// Get sidebar articles (starting from the article after the main grid ends)
const sidebarArticles: Record<string, any[]> = {};
for (const category in finalArticles) {
	sidebarArticles[category] = finalArticles[category].slice(mainArticles[category].length, mainArticles[category].length + 4);
}

// Debug logging
console.log('üîç Debug: Article counts for homepage sections');
for (const category in mainArticles) {
	console.log(`${category} - Main: ${mainArticles[category].length}, Sidebar: ${sidebarArticles[category].length}`);
}

// Log first few articles to check for duplicates
for (const category in mainArticles) {
	console.log(`üîç Debug: First 2 main ${category} articles:`, mainArticles[category].slice(0, 2).map((a: any) => a.title));
	console.log(`üîç Debug: First 2 sidebar ${category} articles:`, sidebarArticles[category].slice(0, 2).map((a: any) => a.title));
}

// Debug author data structure
for (const category in mainArticles) {
	if (mainArticles[category].length > 0 && mainArticles[category][0].author) {
		console.log(`üîç Debug: Author data structure for ${category}:`, JSON.stringify(mainArticles[category][0].author, null, 2));
	}
}
---

<section class="aibuzz-layout">
	<div class="layout-container">
		{HOMEPAGE_CATEGORIES.map((category) => {
			const articles = categoryArticles[category.slug] || [];
			const mainArticles = articles.slice(0, 4);
			const sidebarArticles = articles.slice(4, 8);
			return (
				<section class="content-section" id={category.slug}>
					<div class="section-header">
						<h2 class="section-title">{category.displayName}</h2>
						<a href={`/categories/${category.slug}`} class="view-all-link">View All ‚Üí</a>
					</div>
					<div class="section-layout">
						<div class="main-content">
							<div class="grid-layout-special">
								<div class="top-row">
									{mainArticles.slice(0, 2).map((article: any) => (
										<article class="large-card">
											<a href={getArticleUrl(article)} class="card-image-link">
												<div class="card-image">
													{article.featuredImage ? (
														<img src={article.featuredImage} alt={article.title} />
													) : (
														<div class="placeholder-image">üì∞</div>
													)}
												</div>
											</a>
											<div class="card-content">
												<a href={getCategoryUrl(category.displayName)} class="category-tag category-link-safe">
													{category.displayName}
												</a>
												<div style="height: 16px;"></div>
												<h3><a href={getArticleUrl(article)}>{article.title}</a></h3>
												<p>{article.excerpt}</p>
												<div class="card-meta">
													<span class="author">
														By <a href={`/authors/${typeof article.author?.slug === 'object' ? article.author.slug.current : article.author?.slug || 'anonymous'}`} class="author-link" aria-label={`View profile of ${article.author?.name || 'Anonymous'}`}>
															{article.author?.name || 'Anonymous'}
														</a>
													</span>
													<span class="date">{formatDate(article.publishedAt || Date.now())}</span>
												</div>
											</div>
										</article>
									))}
								</div>
								<div class="bottom-row">
									{mainArticles.slice(2, 4).map((article: any) => (
										<article class="stacked-card">
											<a href={getArticleUrl(article)} class="stacked-image-link">
												<div class="stacked-image">
													{article.featuredImage ? (
														<img src={article.featuredImage} alt={article.title} />
													) : (
														<div class="placeholder-small">üì∞</div>
													)}
												</div>
											</a>
											<div class="stacked-content">
												<a href={getCategoryUrl(category.displayName)} class="category-tag category-link-safe">
													{category.displayName}
												</a>
												<div style="height: 16px;"></div>
												<h4><a href={getArticleUrl(article)}>{article.title}</a></h4>
												<div class="stacked-meta">
													<span class="author">
														<a href={`/authors/${typeof article.author?.slug === 'object' ? article.author.slug.current : article.author?.slug || 'anonymous'}`} class="author-link" aria-label={`View profile of ${article.author?.name || 'Anonymous'}`}>
															{article.author?.name || 'Anonymous'}
														</a>
													</span>
													<span class="date">{formatDate(article.publishedAt || Date.now())}</span>
												</div>
											</div>
										</article>
									))}
								</div>
							</div>
						</div>
						<CategorySidebar categorySlug={category.slug} articles={sidebarArticles} />
					</div>
				</section>
			);
		})}
	</div>
</section>

<style>
	.aibuzz-layout {
		padding: 2rem 0;
		background: var(--bg-primary);
		/* Natural document flow */
		position: relative;
		/* Remove z-index that might cause issues */
		z-index: 1;
		/* Ensure proper spacing for footer */
		margin-bottom: 0;
	}

	.layout-container {
		max-width: 1200px;
		margin: 0 auto;
		padding: 0 2rem;
		/* Natural document flow */
		position: relative;
		z-index: 1;
		/* Remove bottom padding that might interfere */
		padding-bottom: 0;
	}

	.content-section {
		margin-bottom: 4rem;
	}

	.content-section:last-child {
		margin-bottom: 0;
	}

	.section-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 2rem;
		margin-top: 2rem;
		padding-bottom: 1rem;
		border-bottom: 2px solid rgba(0, 212, 255, 0.2);
	}

	.section-title {
		font-size: 2.5rem;
		font-weight: 700;
		color: #ffffff;
		margin: 0;
	}

	.view-all-link {
		color: #00d4ff;
		text-decoration: none;
		font-weight: 600;
		font-size: 1rem;
		transition: color 0.2s ease;
		padding: 0.5rem 1rem;
		border-radius: 8px;
		background: rgba(0, 212, 255, 0.1);
		border: 1px solid rgba(0, 212, 255, 0.2);
	}

	.view-all-link:hover {
		color: #ffffff;
		background: rgba(0, 212, 255, 0.2);
	}

	/* Section Layout */
	.section-layout {
		display: grid;
		grid-template-columns: 1fr 340px;
		gap: 2rem;
		align-items: start;
	}

	.main-content {
		min-width: 0;
	}

	/* Grid Layout for Main Content */
	.grid-layout-special {
		display: flex;
		flex-direction: column;
		gap: 2rem;
		height: 100%;
	}

	/* Top Row: 2 Large Cards Side by Side */
	.top-row {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 2rem;
		flex: 2;
	}

	.large-card {
		background: #1a1a1b;
		border: 1px solid rgba(255, 255, 255, 0.1);
		border-radius: 16px;
		overflow: hidden;
		transition: all 0.2s ease;
		display: flex;
		flex-direction: column;
		will-change: transform;
	}

	.large-card:hover {
		transform: translateY(-4px);
		box-shadow: 0 15px 30px rgba(0, 212, 255, 0.15);
		border-color: rgba(0, 212, 255, 0.3);
	}

	.card-image {
		position: relative;
		height: 250px;
		overflow: hidden;
	}

	.card-image-link {
		display: block;
		text-decoration: none;
		color: inherit;
		cursor: pointer;
	}

	.card-image img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 0.2s ease;
		will-change: transform;
	}

	.large-card:hover .card-image img {
		transform: scale(1.02);
	}

	.placeholder-image {
		width: 100%;
		height: 100%;
		background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(0, 102, 255, 0.2) 100%);
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 4rem;
	}

	.review-score {
		position: absolute;
		top: 15px;
		right: 15px;
		background: linear-gradient(135deg, #00d4ff 0%, #0066ff 100%);
		color: white;
		padding: 0.5rem 1rem;
		border-radius: 20px;
		font-weight: 700;
		font-size: 1.1rem;
	}

	.card-content {
		padding: 2rem;
		flex: 1;
		display: flex;
		flex-direction: column;
	}

	/* Prevent category tags from being stretched by flex container */
	.card-content .category-tag,
	.stacked-content .category-tag {
		align-self: flex-start;
		width: auto;
		flex-shrink: 0;
		/* This should override any display property from category-link-safe */
	}

	.category-tag {
		background: rgba(0, 212, 255, 0.2);
		color: #00d4ff;
		padding: 0.2rem 0.5rem;
		border-radius: 12px;
		font-size: 0.65rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.5px;
		transition: all 0.3s ease;
	}

	.category-tag:hover {
		transform: translateY(-2px);
		box-shadow: 0 6px 16px rgba(0, 212, 255, 0.4);
		background: rgba(0, 212, 255, 0.3);
		color: #ffffff;
	}

	.card-content h3 {
		font-size: 1.4rem;
		font-weight: 600;
		margin: 0 0 1rem 0;
		line-height: 1.3;
		flex: 1;
	}

	.card-content h3 a {
		color: #ffffff;
		text-decoration: none;
		display: inline-block;
		transition: transform 0.1s ease;
	}

	.card-content h3 a:hover {
		color: #00d4ff;
		transform: translateX(2px);
	}

	.card-content p {
		color: #b3b3b3;
		line-height: 1.6;
		margin-bottom: 1.5rem;
		font-size: 0.95rem;
	}

	.review-stars {
		color: #ffb800;
		margin-bottom: 1rem;
		font-size: 1.1rem;
	}

	.ai-agent-indicators {
		display: flex;
		gap: 1rem;
		margin-bottom: 1rem;
	}

	.specialization, .capability {
		background: rgba(255, 184, 0, 0.1);
		color: #ffb800;
		padding: 0.25rem 0.75rem;
		border-radius: 12px;
		font-size: 0.8rem;
		font-weight: 500;
	}

	.tutorial-indicators {
		display: flex;
		gap: 1rem;
		margin-bottom: 1rem;
	}

	.difficulty, .duration {
		background: rgba(168, 85, 247, 0.1);
		color: #a855f7;
		padding: 0.25rem 0.75rem;
		border-radius: 12px;
		font-size: 0.8rem;
		font-weight: 500;
	}

	.card-meta {
		display: flex;
		justify-content: space-between;
		align-items: center;
		font-size: 0.85rem;
		color: #666666;
		border-top: 1px solid rgba(255, 255, 255, 0.1);
		padding-top: 1rem;
		margin-top: auto;
	}

	/* Bottom Row: 2 Large Cards Side by Side */
	.bottom-row {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 2rem;
		flex: 1;
	}

	/* Medium Card: Shorter height for second row */
	.medium-card {
		background: #1a1a1b;
		border: 1px solid rgba(255, 255, 255, 0.1);
		border-radius: 16px;
		overflow: hidden;
		transition: all 0.2s ease;
		display: flex;
		flex-direction: column;
		will-change: transform;
	}

	.medium-card:hover {
		transform: translateY(-4px);
		box-shadow: 0 15px 30px rgba(0, 212, 255, 0.15);
		border-color: rgba(0, 212, 255, 0.3);
	}

	.medium-card .card-image {
		height: 125px; /* Reduced from 180px to 125px (about half of large-card 250px) */
	}

	.medium-card .card-content {
		padding: 1rem;
		display: flex;
		flex-direction: column;
		justify-content: space-between;
		min-height: 140px; /* Ensure consistent height */
	}

	/* Prevent category tags from being stretched by flex container */
	.medium-card .card-content .category-tag {
		align-self: flex-start;
		width: auto;
		flex-shrink: 0;
	}

	.medium-card .card-content h3 {
		font-size: 1.1rem; /* Smaller title */
		margin: 0 0 0.5rem 0; /* Reduced margins */
		line-height: 1.3;
	}

	.medium-card .card-content h3 a {
		color: #ffffff;
		text-decoration: none;
		display: inline-block;
		transition: transform 0.1s ease;
	}

	.medium-card .card-content h3 a:hover {
		color: #00d4ff;
		transform: translateX(2px);
	}

	.medium-card .card-content p {
		font-size: 0.85rem; /* Smaller text */
		margin-bottom: 0.75rem; /* Reduced margin */
		line-height: 1.4;
		/* Limit to 2 lines */
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	.medium-card .ai-agent-indicators {
		margin-bottom: 0.75rem; /* Reduced margin */
		gap: 0.5rem; /* Tighter spacing */
	}

	.medium-card .specialization, 
	.medium-card .capability {
		padding: 0.2rem 0.5rem; /* Smaller padding */
		font-size: 0.7rem; /* Smaller font */
		border-radius: 8px;
	}

	.medium-card .card-meta {
		margin-top: auto; /* Push to bottom */
		padding-top: 0.75rem; /* Reduced padding */
		font-size: 0.75rem; /* Smaller font */
		border-top: 1px solid rgba(255, 255, 255, 0.1);
	}

	/* Tutorials Bottom Row: Stacked Cards Vertically */
	.tutorials-bottom {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	/* News Bottom Row: Stacked Cards Vertically */
	.news-bottom {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	/* Reviews Bottom Row: Stacked Cards Vertically */
	.reviews-bottom {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	/* AI Agents Bottom Row: Stacked Cards Vertically */
	.ai-agents-bottom {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.stacked-card {
		background: #1a1a1b;
		border: 1px solid rgba(255, 255, 255, 0.1);
		border-radius: 12px;
		padding: 2rem;
		display: flex;
		gap: 1.5rem;
		transition: all 0.2s ease;
		will-change: transform;
	}

	.stacked-card:hover {
		transform: translateX(4px);
		box-shadow: 0 8px 20px rgba(0, 212, 255, 0.1);
		border-color: rgba(0, 212, 255, 0.4);
	}

	.stacked-image {
		width: 120px;
		height: 144px; /* Increased from 120px to 144px (20% more) */
		border-radius: 8px;
		overflow: hidden;
		flex-shrink: 0;
	}

	.stacked-image-link {
		display: block;
		text-decoration: none;
		color: inherit;
		cursor: pointer;
		flex-shrink: 0;
	}

	.stacked-image img {
		width: 100%;
		height: 100%;
		object-fit: cover;
	}

	.placeholder-small {
		width: 100%;
		height: 100%;
		background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(0, 102, 255, 0.2) 100%);
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 2rem;
	}

	.stacked-content {
		flex: 1;
		display: flex;
		flex-direction: column;
	}

	.stacked-content h4 {
		font-size: 1.1rem;
		font-weight: 600;
		margin: 0 0 0.75rem 0;
		line-height: 1.3;
	}

	.stacked-content h4 a {
		color: #ffffff;
		text-decoration: none;
		display: inline-block;
		transition: transform 0.1s ease;
	}

	.stacked-content h4 a:hover {
		color: #00d4ff;
		transform: translateX(2px);
	}

	.stacked-meta {
		display: flex;
		justify-content: space-between;
		align-items: center;
		gap: 1rem;
		font-size: 0.8rem;
		color: #666666;
		margin-top: auto;
	}

	/* Responsive Design */
	@media (max-width: 1200px) {
		.section-layout {
			grid-template-columns: 1fr 300px;
			gap: 1.5rem;
		}
		
		.layout-container {
			padding: 0 1.5rem;
		}
	}

	@media (max-width: 768px) {
		.aibuzz-layout {
			padding: 1rem 0;
		}
		
		.layout-container {
			padding: 0 1rem;
		}
		
		.section-layout {
			grid-template-columns: 1fr;
			gap: 1rem;
		}
		
		.content-section {
			margin-bottom: 2rem;
		}
		
		.section-header {
			margin-bottom: 1.5rem;
			margin-top: 1.5rem;
		}
		
		.section-title {
			font-size: 2rem;
		}
		
		/* Top Row: Stack cards vertically on mobile */
		.top-row {
			grid-template-columns: 1fr;
			gap: 1rem;
		}
		
		/* 2x2 Grid: Stack cards vertically on mobile */
		.grid-layout-2x2 {
			grid-template-columns: 1fr;
			grid-template-rows: auto;
			gap: 1rem;
		}
		
		/* Tutorials and News bottom rows: Keep vertical stacking */
		.tutorials-bottom,
		.news-bottom,
		.reviews-bottom,
		.ai-agents-bottom {
			gap: 1rem;
		}
		
		.large-card {
			margin-bottom: 0;
		}
		
		.medium-card {
			margin-bottom: 0;
		}
		
		.grid-card {
			margin-bottom: 0;
		}
		
		.card-content {
			padding: 1.5rem;
		}
		
		/* Prevent category tags from being stretched by flex container on mobile */
		.card-content .category-tag {
			align-self: flex-start;
			width: auto;
			flex-shrink: 0;
		}
		
		.card-content h3 {
			font-size: 1.2rem;
		}
		
		.stacked-card {
			padding: 1rem;
			gap: 1rem;
		}
		
		.stacked-image {
			width: 80px;
			height: 80px;
		}
		
		.stacked-content h4 {
			font-size: 1rem;
		}
		
		/* Prevent category tags from being stretched by flex container on mobile */
		.stacked-content .category-tag {
			align-self: flex-start;
			width: auto;
			flex-shrink: 0;
		}
		
		/* Ensure proper spacing for footer */
		.aibuzz-layout {
			/* Remove min-height that might cause issues */
		}
		
		/* AI Agent indicators on mobile */
		.ai-agent-indicators {
			flex-direction: column;
			gap: 0.25rem;
		}
		
		.ai-agent-indicators span {
			font-size: 0.8rem;
		}
		
		/* Medium card mobile adjustments */
		.medium-card .card-content {
			padding: 0.75rem;
			min-height: auto;
		}
		
		/* Prevent category tags from being stretched by flex container on mobile */
		.medium-card .card-content .category-tag {
			align-self: flex-start;
			width: auto;
			flex-shrink: 0;
		}
		
		.medium-card .card-content h3 {
			font-size: 1rem;
		}
		
		.medium-card .card-content p {
			font-size: 0.8rem;
			-webkit-line-clamp: 3; /* Allow 3 lines on mobile */
		}
		
		.medium-card .ai-agent-indicators {
			flex-direction: column;
			gap: 0.25rem;
		}
		
		.medium-card .specialization,
		.medium-card .capability {
			font-size: 0.65rem;
		}
		
		/* Tutorial indicators on mobile */
		.tutorial-indicators {
			flex-direction: column;
			gap: 0.25rem;
		}
		
		.tutorial-indicators span {
			font-size: 0.8rem;
		}
	}

	@media (max-width: 480px) {
		.aibuzz-layout {
			padding: 0.5rem 0;
		}
		
		.layout-container {
			padding: 0 0.75rem;
		}
		
		.section-header {
			flex-direction: column;
			gap: 1rem;
			text-align: center;
			margin-bottom: 1rem;
		}
		
		.section-title {
			font-size: 1.8rem;
		}
		
		.view-all-link {
			align-self: center;
			font-size: 0.9rem;
			padding: 0.4rem 0.8rem;
		}
		
		.content-section {
			margin-bottom: 1.5rem;
		}
		
		.card-content {
			padding: 1rem;
		}
		
		/* Prevent category tags from being stretched by flex container on mobile */
		.card-content .category-tag {
			align-self: flex-start;
			width: auto;
			flex-shrink: 0;
		}
		
		.card-content h3 {
			font-size: 1.1rem;
		}
		
		.card-content p {
			font-size: 0.9rem;
		}
		
		.stacked-card {
			flex-direction: column;
			text-align: center;
			padding: 0.75rem;
		}
		
		.stacked-image {
			width: 100%;
			height: 120px;
		}
		
		.stacked-content h4 {
			font-size: 0.95rem;
		}
		
		/* Prevent category tags from being stretched by flex container on mobile */
		.stacked-content .category-tag {
			align-self: flex-start;
			width: auto;
			flex-shrink: 0;
		}
		
		/* AI Agent indicators on mobile */
		.ai-agent-indicators {
			flex-direction: column;
			gap: 0.25rem;
		}
		
		.ai-agent-indicators span {
			font-size: 0.8rem;
		}
		
		/* Tutorial indicators on mobile */
		.tutorial-indicators {
			flex-direction: column;
			gap: 0.25rem;
		}
		
		.tutorial-indicators span {
			font-size: 0.8rem;
		}
		
		/* Review stars on mobile */
		.review-stars {
			font-size: 0.9rem;
		}
		
		/* Ensure footer is visible */
		.aibuzz-layout {
			/* Remove min-height that might cause issues */
		}
		
		/* Prevent category tags from being stretched by flex container on mobile */
		.stacked-content .category-tag {
			align-self: flex-start;
			width: auto;
			flex-shrink: 0;
		}
		
		.stacked-meta {
			flex-direction: column;
			gap: 0.25rem;
			align-items: center;
		}
	}

	/* Extra small devices */
	@media (max-width: 360px) {
		.layout-container {
			padding: 0 0.5rem;
		}
		
		.section-title {
			font-size: 1.6rem;
		}
		
		.card-content {
			padding: 0.75rem;
		}
		
		/* Prevent category tags from being stretched by flex container on mobile */
		.card-content .category-tag {
			align-self: flex-start;
			width: auto;
			flex-shrink: 0;
		}
	}

	/* 2x2 Grid Layout for AI Agents */
	.grid-layout-2x2 {
		display: grid;
		grid-template-columns: 1fr 1fr;
		grid-template-rows: 1fr 1fr;
		gap: 2rem;
		height: 100%;
	}

	.grid-card {
		background: #1a1a1b;
		border: 1px solid rgba(255, 255, 255, 0.1);
		border-radius: 16px;
		overflow: hidden;
		transition: all 0.3s ease;
		display: flex;
		flex-direction: column;
		height: 100%;
	}

	.grid-card:hover {
		transform: translateY(-4px);
		box-shadow: 0 8px 32px rgba(0, 212, 255, 0.2);
		border-color: rgba(0, 212, 255, 0.4);
	}

	/* Medium card mobile adjustments */
	.medium-card .card-content {
		padding: 0.75rem;
		min-height: auto;
	}
	
	.medium-card .card-content h3 {
		font-size: 1rem;
	}
	
	.medium-card .card-content p {
		font-size: 0.8rem;
		-webkit-line-clamp: 3; /* Allow 3 lines on mobile */
	}
	
	.medium-card .ai-agent-indicators {
		flex-direction: column;
		gap: 0.25rem;
	}
	
	.medium-card .specialization,
	.medium-card .capability {
		font-size: 0.65rem;
	}

	/* Author link styles */
	.author-link {
		color: #666666;
		text-decoration: none;
		transition: all 0.3s ease;
		border-radius: 4px;
		padding: 2px 4px;
		margin: -2px -4px;
	}

	.author-link:hover {
		color: #00d4ff;
		text-decoration: none;
		transform: translateY(-1px);
	}

	.author-link:focus {
		outline: 2px solid #00d4ff;
		outline-offset: 2px;
		background: rgba(0, 212, 255, 0.1);
	}

	/* Ensure author text maintains proper spacing */
	.author {
		display: inline-flex;
		align-items: center;
		gap: 0.25rem;
	}
</style>

<script>
	// Initialize lazy loading and image optimization
	document.addEventListener('DOMContentLoaded', function() {
		// Setup intersection observer for lazy loading
		const imageObserver = new IntersectionObserver((entries, observer) => {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					const img = entry.target as HTMLImageElement;
					const dataSrc = img.dataset.src;
					
					if (dataSrc) {
						img.src = dataSrc;
						img.classList.remove('lazy');
						observer.unobserve(img);
					}
				}
			});
		}, {
			rootMargin: '50px 0px',
			threshold: 0.01
		});
		
		// Observe all lazy images
		document.querySelectorAll('img[data-src]').forEach(img => {
			imageObserver.observe(img);
		});
		
		// Preload critical images
		const criticalImages = document.querySelectorAll('img[fetchpriority="high"]');
		criticalImages.forEach(img => {
			const imgElement = img as HTMLImageElement;
			const link = document.createElement('link');
			link.rel = 'preload';
			link.as = 'image';
			link.href = imgElement.src;
			document.head.appendChild(link);
		});
	});
</script>