---
import { getCollection } from 'astro:content'
import AuthorLayout from '../../layouts/AuthorLayout.astro'
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import '../../styles/global.css';

// Enable static generation for this page
export const prerender = true;

export async function getStaticPaths() {
  const authors = await getCollection('authors')
  
  return authors.map((author) => ({
    params: { slug: author.slug },
    props: { author },
  }))
}

const { slug } = Astro.params
const { author } = Astro.props

// If author not found in props, try to fetch it
const authorData = author || (await getCollection('authors')).find(a => a.slug === slug)

if (!authorData) {
  return Astro.redirect('/404')
}

// Get articles by this author
const allArticles = await getCollection('articles')
const articles = allArticles.filter(article => article.data.author === authorData.data.name)
---

<AuthorLayout author={authorData} articles={articles} />