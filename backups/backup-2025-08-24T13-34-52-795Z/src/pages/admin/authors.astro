---
// Authors Management Page
import { getCollection } from 'astro:content';

// Get all authors
const authors = await getCollection('authors');

const pageTitle = 'Authors Management';
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{pageTitle} - AI Buzz Media</title>
    <meta name="description" content="Manage authors for AI Buzz Media">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="admin-container">
        <header class="admin-header">
            <div class="header-content">
                <h1>üë• Authors Management</h1>
                <div class="header-actions">
                    <button class="btn-primary" id="add-author-btn">üë§ Add New Author</button>
                    <a href="/admin" class="btn-secondary">‚Üê Back to Admin</a>
                </div>
            </div>
        </header>

        <!-- Author Creation/Editing Modal -->
        <div id="author-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-title">Create New Author</h2>
                    <span class="close">&times;</span>
                </div>
                <form id="author-form">
                    <div class="form-group">
                        <label for="author-name">Author Name *</label>
                        <input type="text" id="author-name" name="name" required maxlength="100" placeholder="Enter author's full name">
                    </div>
                    
                    <div class="form-group">
                        <label for="author-slug">Slug *</label>
                        <input type="text" id="author-slug" name="slug" required maxlength="100" placeholder="author-name (auto-generated)">
                        <small class="form-help">URL-friendly identifier (auto-generated from name)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="author-title">Title/Position</label>
                        <input type="text" id="author-title" name="title" maxlength="100" placeholder="e.g., AI Expert, Business Strategist">
                    </div>
                    
                    <div class="form-group">
                        <label for="author-bio">Bio *</label>
                        <textarea id="author-bio" name="bio" required rows="4" placeholder="Brief biography of the author"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="author-twitter">Twitter Handle</label>
                            <input type="text" id="author-twitter" name="twitter" placeholder="@username">
                        </div>
                        
                        <div class="form-group">
                            <label for="author-linkedin">LinkedIn</label>
                            <input type="text" id="author-linkedin" name="linkedin" placeholder="linkedin.com/in/username">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="author-github">GitHub</label>
                        <input type="text" id="author-github" name="github" placeholder="github.com/username">
                    </div>
                    
                    <div class="form-group">
                        <label for="author-avatar">Avatar Image</label>
                        <div class="avatar-upload-container">
                            <input type="file" id="avatar-file" name="avatar" accept="image/*" class="avatar-file-input">
                            <div class="avatar-preview" id="avatar-preview">
                                <div class="avatar-placeholder">
                                    <span>üì∑</span>
                                    <small>Click to upload image</small>
                                </div>
                            </div>
                            <input type="text" id="author-avatar" name="avatar-path" placeholder="Or enter image path manually" class="avatar-path-input">
                        </div>
                        <small class="form-help">Upload an image or provide a path. Max size: 5MB</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="cancel-author">Cancel</button>
                        <button type="submit" class="btn-primary">Save Author</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="delete-modal" class="modal">
            <div class="modal-content delete-modal">
                <div class="modal-header">
                    <h2>Delete Author</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="delete-content">
                    <p>Are you sure you want to delete <strong id="delete-author-name"></strong>?</p>
                    <p class="warning">This action cannot be undone and will remove all associated content.</p>
                    <div class="delete-actions">
                        <button class="btn-secondary" id="cancel-delete">Cancel</button>
                        <button class="btn-danger" id="confirm-delete">Delete Author</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Dashboard -->
        <section class="analytics-section">
            <div class="section-header">
                <h2>üìä Author Analytics Dashboard</h2>
                <div class="section-actions">
                    <button class="btn-secondary" id="export-analytics">üìà Export Data</button>
                    <button class="btn-primary" id="refresh-analytics">üîÑ Refresh</button>
                </div>
            </div>
            
            <div class="analytics-grid">
                <div class="analytics-card">
                    <div class="analytics-icon">üë•</div>
                    <div class="analytics-content">
                        <h3>Total Authors</h3>
                        <div class="analytics-value">{authors.length}</div>
                        <div class="analytics-change positive">+{authors.length} this month</div>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <div class="analytics-icon">üìù</div>
                    <div class="analytics-content">
                        <h3>Total Articles</h3>
                        <div class="analytics-value" id="total-articles">-</div>
                        <div class="analytics-change positive">+0 this month</div>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <div class="analytics-icon">üëÅÔ∏è</div>
                    <div class="analytics-content">
                        <h3>Total Views</h3>
                        <div class="analytics-value" id="total-views">-</div>
                        <div class="analytics-change positive">+0 this month</div>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <div class="analytics-icon">‚≠ê</div>
                    <div class="analytics-content">
                        <h3>Avg. Engagement</h3>
                        <div class="analytics-value" id="avg-engagement">-</div>
                        <div class="analytics-change neutral">No change</div>
                    </div>
                </div>
            </div>
            
            <div class="analytics-details">
                <div class="author-performance">
                    <h3>Author Performance Overview</h3>
                    <div class="performance-table" id="performance-table">
                        <table class="analytics-table">
                            <thead>
                                <tr>
                                    <th>Author</th>
                                    <th>Articles</th>
                                    <th>Views</th>
                                    <th>Avg. Views</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="table-content">
                                <!-- Performance data will be populated here -->
                                <!-- Performance data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section class="authors-section">
            <div class="section-header">
                <h2>Current Authors ({authors.length})</h2>
                <div class="section-actions">
                    <button class="btn-primary" id="refresh-authors">üîÑ Refresh</button>
                </div>
            </div>

            <div class="authors-grid">
                {authors.length === 0 ? (
                    <div class="empty-state">
                        <div class="empty-icon">üë•</div>
                        <h3>No Authors Found</h3>
                        <p>Get started by adding your first author to the team.</p>
                        <button class="btn-primary" id="add-first-author">Add First Author</button>
                    </div>
                ) : (
                    authors.map((author: any) => (
                        <div class="author-card" data-author-slug={author.slug}>
                            <div class="author-header">
                                <div class="author-avatar">
                                    {author.data.avatar ? (
                                        <img src={author.data.avatar} alt={author.data.name} onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                        <span style="display: none;">{author.data.name.charAt(0).toUpperCase()}</span>
                                    ) : (
                                        <span>{author.data.name.charAt(0).toUpperCase()}</span>
                                    )}
                                </div>
                                <div class="author-info">
                                    <h3 class="author-name">{author.data.name}</h3>
                                    <p class="author-title">{author.data.title || 'AI Expert'}</p>
                                    <div class="author-slug">@{author.slug}</div>
                                </div>
                                <div class="author-status">
                                    <span class="status-badge active">Active</span>
                                </div>
                            </div>
                            
                            <div class="author-bio">
                                <p>{author.data.bio || 'No bio available'}</p>
                            </div>
                            
                            <div class="author-social">
                                {author.data.social?.twitter && (
                                    <a href={`https://twitter.com/${author.data.social.twitter}`} target="_blank" class="social-link twitter">
                                        üê¶ Twitter
                                    </a>
                                )}
                                {author.data.social?.linkedin && (
                                    <a href={`https://linkedin.com/in/${author.data.social.linkedin}`} target="_blank" class="social-link linkedin">
                                        üíº LinkedIn
                                    </a>
                                )}
                                {author.data.social?.github && (
                                    <a href={`https://github.com/${author.data.social.github}`} target="_blank" class="social-link github">
                                        üìö GitHub
                                    </a>
                                )}
                            </div>
                            
                            <div class="author-actions">
                                <a href={`/authors/${author.slug}`} class="btn btn-view" target="_blank">
                                    üëÅÔ∏è View Profile
                                </a>
                                <button class="btn btn-edit" data-author-slug={author.slug} data-author-data={JSON.stringify(author.data)}>
                                    ‚úèÔ∏è Edit
                                </button>
                                <button class="btn btn-delete" data-author-slug={author.slug} data-author-name={author.data.name}>
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                    ))
                )}
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Modal functionality
            const authorModal = document.getElementById('author-modal') as HTMLDivElement;
            const deleteModal = document.getElementById('delete-modal') as HTMLDivElement;
            const addAuthorBtn = document.getElementById('add-author-btn') as HTMLButtonElement;
            const addFirstAuthorBtn = document.getElementById('add-first-author') as HTMLButtonElement | null;
            const closeBtns = document.querySelectorAll('.close');
            const cancelBtns = document.querySelectorAll('.btn-secondary');
            const authorForm = document.getElementById('author-form') as HTMLFormElement;
            const modalTitle = document.getElementById('modal-title') as HTMLHeadingElement;
            const authorSlugInput = document.getElementById('author-slug') as HTMLInputElement;
            const authorNameInput = document.getElementById('author-name') as HTMLInputElement;

            // Type definitions
            interface AuthorData {
                name: string;
                title?: string;
                bio: string;
                avatar?: string;
                social?: {
                    twitter?: string;
                    linkedin?: string;
                    github?: string;
                };
            }

            interface AuthorFormData extends AuthorData {
                slug: string;
            }

            interface AuthorPerformance {
                name: string;
                slug: string;
                articles: number;
                views: number;
                avgViews: number;
                status: string;
            }

            interface AnalyticsData {
                totalArticles: number;
                totalViews: number;
                avgEngagement: number;
                authorPerformance: AuthorPerformance[];
            }

            // Open modal for new author
            function openNewAuthorModal(): void {
                if (!modalTitle || !authorForm || !authorModal) return;
                
                modalTitle.textContent = 'Create New Author';
                authorForm.reset();
                authorForm.setAttribute('data-mode', 'create');
                
                // Reset avatar preview
                if (avatarPreview) {
                    avatarPreview.innerHTML = `
                        <div class="avatar-placeholder">
                            <span>üì∑</span>
                            <small>Click to upload image</small>
                        </div>
                    `;
                }
                
                authorModal.style.display = 'block';
            }

            // Open modal for editing author
            function openEditAuthorModal(authorData: AuthorData, slug: string): void {
                if (!modalTitle || !authorForm || !authorModal) return;
                
                modalTitle.textContent = 'Edit Author';
                authorForm.setAttribute('data-mode', 'edit');
                authorForm.setAttribute('data-author-slug', slug);
                
                // Populate form with existing data
                const nameInput = document.getElementById('author-name') as HTMLInputElement;
                const slugInput = document.getElementById('author-slug') as HTMLInputElement;
                const titleInput = document.getElementById('author-title') as HTMLInputElement;
                const bioInput = document.getElementById('author-bio') as HTMLTextAreaElement;
                const twitterInput = document.getElementById('author-twitter') as HTMLInputElement;
                const linkedinInput = document.getElementById('author-linkedin') as HTMLInputElement;
                const githubInput = document.getElementById('author-github') as HTMLInputElement;
                const avatarInput = document.getElementById('author-avatar') as HTMLInputElement;

                if (nameInput) nameInput.value = authorData.name || '';
                if (slugInput) slugInput.value = slug || '';
                if (titleInput) titleInput.value = authorData.title || '';
                if (bioInput) bioInput.value = authorData.bio || '';
                if (twitterInput) twitterInput.value = authorData.social?.twitter || '';
                if (linkedinInput) linkedinInput.value = authorData.social?.linkedin || '';
                if (githubInput) githubInput.value = authorData.social?.github || '';
                if (avatarInput) avatarInput.value = authorData.avatar || '';
                
                // Update avatar preview if avatar exists
                if (avatarPreview && authorData.avatar) {
                    avatarPreview.innerHTML = `<img src="${authorData.avatar}" alt="Avatar preview" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">`;
                } else if (avatarPreview) {
                    avatarPreview.innerHTML = `
                        <div class="avatar-placeholder">
                            <span>üì∑</span>
                            <small>Click to upload image</small>
                        </div>
                    `;
                }
                
                authorModal.style.display = 'block';
            }

            // Close modals
            function closeModal(modal: HTMLDivElement): void {
                modal.style.display = 'none';
            }

            // Event listeners
            if (addAuthorBtn) {
                addAuthorBtn.addEventListener('click', openNewAuthorModal);
            }
            if (addFirstAuthorBtn) {
                addFirstAuthorBtn.addEventListener('click', openNewAuthorModal);
            }

            // Close modal when clicking close button or outside modal
            closeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (authorModal && authorModal.style.display === 'block') closeModal(authorModal);
                    if (deleteModal && deleteModal.style.display === 'block') closeModal(deleteModal);
                });
            });

            cancelBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (authorModal && authorModal.style.display === 'block') closeModal(authorModal);
                    if (deleteModal && deleteModal.style.display === 'block') closeModal(deleteModal);
                });
            });

            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === authorModal) closeModal(authorModal);
                if (event.target === deleteModal) closeModal(deleteModal);
            });

            // Auto-generate slug from name
            if (authorNameInput && authorSlugInput) {
                authorNameInput.addEventListener('input', function() {
                    const name = (this as HTMLInputElement).value;
                    const slug = name.toLowerCase()
                        .replace(/[^a-z0-9\s-]/g, '')
                        .replace(/\s+/g, '-')
                        .replace(/-+/g, '-')
                        .trim();
                    authorSlugInput.value = slug;
                });
            }

            // Avatar upload functionality
            const avatarFileInput = document.getElementById('avatar-file') as HTMLInputElement;
            const avatarPreview = document.getElementById('avatar-preview') as HTMLDivElement;
            const avatarPathInput = document.getElementById('author-avatar') as HTMLInputElement;

            if (avatarFileInput && avatarPreview && avatarPathInput) {
                // Handle file selection
                avatarFileInput.addEventListener('change', async function() {
                    const file = this.files?.[0];
                    if (!file) return;

                    // Validate file
                    if (!file.type.startsWith('image/')) {
                        showNotification('Please select an image file', 'warning');
                        return;
                    }

                    if (file.size > 5 * 1024 * 1024) { // 5MB
                        showNotification('File size must be less than 5MB', 'warning');
                        return;
                    }

                    // Show preview
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        if (avatarPreview) {
                            avatarPreview.innerHTML = `<img src="${e.target?.result}" alt="Avatar preview" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">`;
                        }
                    };
                    reader.readAsDataURL(file);

                    // Upload file
                    try {
                        const formData = new FormData();
                        formData.append('avatar', file);

                        const response = await fetch('/api/upload/avatar', {
                            method: 'POST',
                            body: formData
                        });

                        if (response.ok) {
                            const result = await response.json();
                            avatarPathInput.value = result.filePath;
                            showNotification('Avatar uploaded successfully!', 'success');
                        } else {
                            const error = await response.json();
                            throw new Error(error.error || 'Upload failed');
                        }
                    } catch (error) {
                        console.error('Upload error:', error);
                        showNotification('Failed to upload avatar. Please try again.', 'warning');
                        // Reset preview
                        avatarPreview.innerHTML = `
                            <div class="avatar-placeholder">
                                <span>üì∑</span>
                                <small>Click to upload image</small>
                            </div>
                        `;
                    }
                });

                // Handle preview click to trigger file input
                avatarPreview.addEventListener('click', function() {
                    avatarFileInput.click();
                });
            }

            // Handle form submission
            if (authorForm) {
                authorForm.addEventListener('submit', function(e: Event) {
                    e.preventDefault();
                    
                    const formData = new FormData(authorForm);
                    const mode = authorForm.getAttribute('data-mode');
                    const authorSlug = authorForm.getAttribute('data-author-slug');
                    
                    const authorData: AuthorFormData = {
                        name: formData.get('name') as string,
                        slug: formData.get('slug') as string,
                        title: formData.get('title') as string,
                        bio: formData.get('bio') as string,
                        avatar: formData.get('avatar-path') as string,
                        social: {
                            twitter: formData.get('twitter') as string,
                            linkedin: formData.get('linkedin') as string,
                            github: formData.get('github') as string
                        }
                    };

                    if (mode === 'create') {
                        createAuthor(authorData);
                    } else if (mode === 'edit') {
                        updateAuthor(authorSlug || '', authorData);
                    }
                });
            }

            // Create new author
            async function createAuthor(authorData: AuthorData): Promise<void> {
                console.log('Creating new author:', authorData);
                
                try {
                    // Call backend API to create author
                    const response = await fetch('/api/authors', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(authorData)
                    });

                    if (response.ok) {
                        showNotification('Author created successfully!', 'success');
                        closeModal(authorModal);
                        // Refresh the page to show new author
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        throw new Error('Failed to create author');
                    }
                } catch (error) {
                    console.error('Error creating author:', error);
                    showNotification('Failed to create author. Please try again.', 'warning');
                }
            }

            // Update existing author
            async function updateAuthor(slug: string, authorData: AuthorData): Promise<void> {
                console.log('Updating author:', slug, authorData);
                
                try {
                    // Call backend API to update author
                    const response = await fetch(`/api/authors/${slug}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(authorData)
                    });

                    if (response.ok) {
                        showNotification('Author updated successfully!', 'success');
                        closeModal(authorModal);
                        // Refresh the page to show updated author
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        throw new Error('Failed to update author');
                    }
                } catch (error) {
                    console.error('Error updating author:', error);
                    showNotification('Failed to update author. Please try again.', 'warning');
                }
            }

            // Edit author buttons
            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', function(this: HTMLButtonElement) {
                    const slug = this.getAttribute('data-author-slug');
                    const authorData = JSON.parse(this.getAttribute('data-author-data') || '{}');
                    if (slug) {
                        openEditAuthorModal(authorData, slug);
                    }
                });
            });

            // Delete author buttons
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', function(this: HTMLButtonElement) {
                    const slug = this.getAttribute('data-author-slug');
                    const name = this.getAttribute('data-author-name');
                    
                    if (!slug || !name) return;
                    
                    // Show delete confirmation modal
                    const deleteNameElement = document.getElementById('delete-author-name');
                    if (deleteNameElement) {
                        deleteNameElement.textContent = name;
                    }
                    if (deleteModal) {
                        deleteModal.setAttribute('data-author-slug', slug);
                        deleteModal.style.display = 'block';
                    }
                });
            });

            // Confirm delete
            const confirmDeleteBtn = document.getElementById('confirm-delete');
            if (confirmDeleteBtn) {
                confirmDeleteBtn.addEventListener('click', function() {
                    const slug = deleteModal?.getAttribute('data-author-slug');
                    if (slug) {
                        deleteAuthor(slug);
                    }
                });
            }

            // Delete author function
            async function deleteAuthor(slug: string): Promise<void> {
                console.log('Deleting author:', slug);
                
                try {
                    // Call backend API to delete author
                    const response = await fetch(`/api/authors/${slug}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        showNotification('Author deleted successfully!', 'success');
                        closeModal(deleteModal);
                        
                        // Remove the author card from the UI
                        const authorCard = document.querySelector(`[data-author-slug="${slug}"]`);
                        if (authorCard) {
                            authorCard.remove();
                        }
                        
                        // Refresh the page to update the count
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        throw new Error('Failed to delete author');
                    }
                } catch (error) {
                    console.error('Error deleting author:', error);
                    showNotification('Failed to delete author. Please try again.', 'warning');
                }
            }

            // Analytics functionality
            let analyticsData: AnalyticsData = {
                totalArticles: 0,
                totalViews: 0,
                avgEngagement: 0,
                authorPerformance: []
            };

            // Initialize analytics
            async function initializeAnalytics() {
                await loadAnalyticsData();
                updateAnalyticsDisplay();
                populatePerformanceTable();
            }

            // Load analytics data
            async function loadAnalyticsData() {
                try {
                    // Fetch analytics data from API
                    const response = await fetch('/api/analytics/authors');
                    if (response.ok) {
                        const data = await response.json();
                        analyticsData = {
                            totalArticles: data.totalArticles || 0,
                            totalViews: data.totalViews || 0,
                            avgEngagement: data.avgEngagement || 0,
                            authorPerformance: data.authorPerformance || []
                        };
                    } else {
                        throw new Error('Failed to fetch analytics');
                    }
                } catch (error) {
                    console.error('Error loading analytics:', error);
                    
                    // Fallback to mock data if API fails
                    const authorCards = document.querySelectorAll('.author-card');
                    const currentAuthors = Array.from(authorCards).map(card => {
                        const slug = card.getAttribute('data-author-slug') || '';
                        const name = card.querySelector('.author-name')?.textContent || 'Unknown';
                        return { slug, name };
                    });

                    analyticsData = {
                        totalArticles: 12,
                        totalViews: 15420,
                        avgEngagement: 85.2,
                        authorPerformance: currentAuthors.map((author: { name: string; slug: string }) => ({
                            name: author.name,
                            slug: author.slug,
                            articles: Math.floor(Math.random() * 8) + 1,
                            views: Math.floor(Math.random() * 5000) + 100,
                            avgViews: 0,
                            status: 'Active'
                        }))
                    };

                    // Calculate average views per author
                    analyticsData.authorPerformance.forEach(author => {
                        author.avgViews = Math.round(author.views / author.articles);
                    });
                    
                    showNotification('Using fallback analytics data', 'info');
                }
            }

            // Update analytics display
            function updateAnalyticsDisplay() {
                const totalArticlesEl = document.getElementById('total-articles');
                const totalViewsEl = document.getElementById('total-views');
                const avgEngagementEl = document.getElementById('avg-engagement');

                if (totalArticlesEl) totalArticlesEl.textContent = analyticsData.totalArticles.toLocaleString();
                if (totalViewsEl) totalViewsEl.textContent = analyticsData.totalViews.toLocaleString();
                if (avgEngagementEl) avgEngagementEl.textContent = analyticsData.avgEngagement + '%';
            }

            // Populate performance table
            function populatePerformanceTable() {
                const tableContent = document.getElementById('table-content');
                if (!tableContent) {
                    console.error('Table content element not found!');
                    return;
                }

                if (analyticsData.authorPerformance.length === 0) {
                    tableContent.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: rgba(255,255,255,0.6);">No data available</td></tr>';
                    return;
                }

                const tableRows = analyticsData.authorPerformance.map(author => {
                    const row = document.createElement('tr');
                    row.className = 'table-row';
                    
                    // Create each cell with inline styles to ensure padding
                    const nameCell = document.createElement('td');
                    nameCell.className = 'author-name';
                    nameCell.textContent = author.name;
                    nameCell.style.padding = '2px 12px';
                    nameCell.style.boxSizing = 'border-box';
                    
                    const articlesCell = document.createElement('td');
                    articlesCell.className = 'article-count';
                    articlesCell.textContent = author.articles.toString();
                    articlesCell.style.padding = '2px 12px';
                    articlesCell.style.boxSizing = 'border-box';
                    
                    const viewsCell = document.createElement('td');
                    viewsCell.className = 'view-count';
                    viewsCell.textContent = author.views.toLocaleString();
                    viewsCell.style.padding = '2px 12px';
                    viewsCell.style.boxSizing = 'border-box';
                    
                    const avgViewsCell = document.createElement('td');
                    avgViewsCell.className = 'avg-views';
                    avgViewsCell.textContent = author.avgViews.toLocaleString();
                    avgViewsCell.style.padding = '2px 12px';
                    avgViewsCell.style.boxSizing = 'border-box';
                    
                    const statusCell = document.createElement('td');
                    statusCell.className = 'status-badge';
                    statusCell.textContent = author.status;
                    statusCell.style.padding = '2px 12px';
                    statusCell.style.boxSizing = 'border-box';
                    
                    // Append cells to row
                    row.appendChild(nameCell);
                    row.appendChild(articlesCell);
                    row.appendChild(viewsCell);
                    row.appendChild(avgViewsCell);
                    row.appendChild(statusCell);
                    
                    return row;
                });

                // Clear existing content and append new rows
                tableContent.innerHTML = '';
                tableRows.forEach(row => tableContent.appendChild(row));
                

            }

            // Export analytics data
            function exportAnalyticsData() {
                const dataStr = JSON.stringify(analyticsData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `author-analytics-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
                showNotification('Analytics data exported successfully!', 'success');
            }

            // Event listeners for analytics
            const exportBtn = document.getElementById('export-analytics');
            const refreshAnalyticsBtn = document.getElementById('refresh-analytics');

            if (exportBtn) {
                exportBtn.addEventListener('click', exportAnalyticsData);
            }

            if (refreshAnalyticsBtn) {
                refreshAnalyticsBtn.addEventListener('click', async function() {
                    await loadAnalyticsData();
                    updateAnalyticsDisplay();
                    populatePerformanceTable();
                    showNotification('Analytics refreshed!', 'success');
                });
            }

            // Refresh authors
            const refreshBtn = document.getElementById('refresh-authors');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    location.reload();
                });
            }

            // Show notification
            function showNotification(message: string, type: 'success' | 'warning' | 'info'): void {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => notification.classList.add('show'), 100);
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }

            // Initialize analytics when page loads
            initializeAnalytics();
        });
    </script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a0b; color: #fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        
        .admin-container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .admin-header { 
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(0, 102, 255, 0.1) 100%); 
            border: 1px solid rgba(0, 212, 255, 0.2); 
            border-radius: 16px; 
            padding: 30px; 
            margin-bottom: 30px; 
            backdrop-filter: blur(20px);
        }
        
        .header-content { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px;
        }
        
        .header-content h1 { 
            color: #00d4ff; 
            margin: 0; 
            font-size: 28px; 
            font-weight: 700;
        }
        
        .header-actions { 
            display: flex; 
            gap: 12px; 
            flex-wrap: wrap;
        }
		
		.section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .section-header h2 { font-size: 22px; font-weight: 600; color: #fff; }
        .section-actions { display: flex; gap: 16px; }
        
        .btn-primary { background: linear-gradient(90deg, #00d4ff, #0099cc); color: #000; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .btn-primary:hover { background: linear-gradient(90deg, #0099cc, #007399); transform: translateY(-1px); }
        
        .btn-secondary { background: rgba(255, 255, 255, 0.1); color: #fff; border: 1px solid rgba(255, 255, 255, 0.2); padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.2); transform: translateY(-1px); }
        
        /* Analytics Styles */
        .analytics-section { margin-bottom: 32px; }
        .analytics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 32px; }
        
        .analytics-card { background: rgba(26, 26, 27, 0.95); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; display: flex; align-items: center; gap: 16px; transition: all 0.3s ease; }
        .analytics-card:hover { border-color: rgba(0, 212, 255, 0.3); transform: translateY(-2px); }
        
        .analytics-icon { font-size: 32px; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; background: rgba(0, 212, 255, 0.1); border-radius: 12px; }
        
        .analytics-content h3 { color: rgba(255, 255, 255, 0.7); font-size: 14px; font-weight: 500; margin-bottom: 8px; }
        .analytics-value { color: #00d4ff; font-size: 28px; font-weight: 700; margin-bottom: 4px; }
        .analytics-change { font-size: 12px; font-weight: 500; }
        .analytics-change.positive { color: #22c55e; }
        .analytics-change.negative { color: #ef4444; }
        .analytics-change.neutral { color: rgba(255, 255, 255, 0.6); }
        
        .analytics-details { background: rgba(26, 26, 27, 0.95); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 24px; }
        .analytics-details h3 { color: #fff; font-size: 18px; margin-bottom: 20px; }
        
        .performance-table { 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            border-radius: 8px; 
            overflow: hidden;
            overflow-x: auto;
            min-width: 100%;
        }
        
        .analytics-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            line-height: 1.4;
            background: rgba(0, 0, 0, 0.3);
            display: table;
            table-layout: fixed;
            font-family: inherit;
            color: #fff;
            /* Reset any inherited table styles */
            box-sizing: border-box;
        }
        

        
        .analytics-table th {
            background: rgba(0, 212, 255, 0.1);
            color: #00d4ff;
            font-weight: 600;
            padding: 16px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            vertical-align: middle;
            display: table-cell;
        }
        
        .analytics-table th:nth-child(2),
        .analytics-table th:nth-child(3),
        .analytics-table th:nth-child(4),
        .analytics-table th:nth-child(5) {
            text-align: left;
        }
        
        .analytics-table td {
            padding: 2px 12px !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            vertical-align: middle;
            display: table-cell;
            /* Reset any inherited cell styles */
            box-sizing: border-box;
            margin: 0;
        }
        
        .analytics-table tr {
            display: table-row;
        }
        
        .analytics-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .analytics-table tr:last-child td {
            border-bottom: none;
        }
        
        .analytics-table .author-name {
            font-weight: 500;
            color: #fff;
            text-align: left;
        }
        
        .analytics-table .article-count,
        .analytics-table .view-count,
        .analytics-table .avg-views {
            text-align: left;
            font-weight: 500;
            color: #fff;
        }
        
        .analytics-table .status-badge {
            text-align: left;
            color: #fff;
        }
        
        /* Ensure all table cells align with their headers */
        .analytics-table td:nth-child(1) {
            text-align: left;
        }
        
        .analytics-table td:nth-child(2),
        .analytics-table td:nth-child(3),
        .analytics-table td:nth-child(4),
        .analytics-table td:nth-child(5) {
            text-align: left;
        }
        
        /* Table cell padding - clean and simple */
        .analytics-table td {
            padding: 2px 12px !important;
            box-sizing: border-box;
        }
        

        

        
        .analytics-table .status-badge.active {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
        }
        
        .authors-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 24px; }
        
        .author-card { background: rgba(26, 26, 27, 0.95); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; transition: all 0.3s ease; }
        .author-card:hover { border-color: rgba(0, 212, 255, 0.3); transform: translateY(-2px); }
        
        .author-header { display: flex; align-items: flex-start; margin-bottom: 16px; }
        .author-avatar { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #00d4ff, #0099cc); display: flex; align-items: center; justify-content: center; font-size: 24px; color: #000; margin-right: 16px; flex-shrink: 0; }
        .author-avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
        .author-info { flex: 1; }
        .author-name { font-size: 18px; font-weight: 600; color: #fff; margin-bottom: 4px; }
        .author-title { color: rgba(255, 255, 255, 0.7); font-size: 14px; margin-bottom: 4px; }
        .author-slug { color: #00d4ff; font-size: 12px; font-family: monospace; }
        .author-status { margin-left: auto; }
        .status-badge { background: rgba(34, 197, 94, 0.1); color: #22c55e; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; }
        
        .author-bio { color: rgba(255, 255, 255, 0.8); line-height: 1.6; margin-bottom: 16px; }
        
        .author-social { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
        .social-link { background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.8); padding: 6px 12px; border-radius: 6px; font-size: 12px; text-decoration: none; transition: all 0.3s ease; }
        .social-link:hover { background: rgba(255, 255, 255, 0.2); color: #fff; }
        .social-link.twitter:hover { background: rgba(29, 161, 242, 0.2); }
        .social-link.linkedin:hover { background: rgba(0, 119, 181, 0.2); }
        .social-link.github:hover { background: rgba(36, 41, 46, 0.2); }
        
        .author-actions { display: flex; gap: 12px; flex-wrap: wrap; }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; }
        .btn-view { background: rgba(0, 212, 255, 0.1); color: #00d4ff; border: 1px solid rgba(0, 212, 255, 0.2); }
        .btn-view:hover { background: rgba(0, 212, 255, 0.2); }
        .btn-edit { background: rgba(255, 193, 7, 0.1); color: #ffc107; border: 1px solid rgba(255, 193, 7, 0.2); }
        .btn-edit:hover { background: rgba(255, 193, 7, 0.2); }
        .btn-delete { background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.2); }
        .btn-delete:hover { background: rgba(239, 68, 68, 0.2); }
        
        .empty-state { text-align: center; padding: 60px 20px; }
        .empty-icon { font-size: 48px; margin-bottom: 16px; }
        .empty-state h3 { color: #fff; font-size: 20px; margin-bottom: 8px; }
        .empty-state p { color: rgba(255, 255, 255, 0.7); margin-bottom: 24px; }
        
        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); }
        .modal-content { background: #1a1a1b; margin: 5% auto; padding: 0; border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 16px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { color: #00d4ff; margin: 0; }
        .close { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: #00d4ff; }
        
        /* Form Styles */
        #author-form { padding: 24px; }
        .form-group { margin-bottom: 20px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #fff; font-weight: 500; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; background: rgba(255, 255, 255, 0.05); color: #fff; font-size: 14px; }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: #00d4ff; background: rgba(255, 255, 255, 0.1); }
        .form-group input::placeholder, .form-group textarea::placeholder { color: rgba(255, 255, 255, 0.5); }
        .form-help { color: rgba(255, 255, 255, 0.6); font-size: 12px; margin-top: 4px; }
        
        /* Avatar Upload Styles */
        .avatar-upload-container { display: flex; flex-direction: column; gap: 12px; }
        .avatar-file-input { display: none; }
        .avatar-preview { width: 80px; height: 80px; border: 2px dashed rgba(255, 255, 255, 0.3); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.05); }
        .avatar-preview:hover { border-color: #00d4ff; background: rgba(0, 212, 255, 0.1); }
        .avatar-placeholder { text-align: center; color: rgba(255, 255, 255, 0.6); }
        .avatar-placeholder span { font-size: 24px; display: block; margin-bottom: 4px; }
        .avatar-placeholder small { font-size: 10px; }
        .avatar-path-input { margin-top: 8px; }
        
        .form-actions { display: flex; gap: 16px; justify-content: flex-end; margin-top: 24px; }
        
        /* Delete Modal */
        .delete-modal .modal-content { max-width: 500px; }
        .delete-content { padding: 24px; text-align: center; }
        .delete-content p { margin-bottom: 16px; color: rgba(255, 255, 255, 0.8); }
        .warning { color: #ffc107; font-weight: 500; }
        .delete-actions { display: flex; gap: 16px; justify-content: center; margin-top: 24px; }
        .btn-danger { background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.2); padding: 12px 24px; border-radius: 8px; cursor: pointer; }
        .btn-danger:hover { background: rgba(239, 68, 68, 0.2); }
        
        .notification { position: fixed; top: 20px; right: 20px; padding: 12px 20px; border-radius: 8px; color: #fff; z-index: 1000; transform: translateX(100%); transition: transform 0.3s ease; }
        .notification.show { transform: translateX(0); }
        .notification.success { background: #22c55e; }
        .notification.warning { background: #f7931e; }
        .notification.info { background: #00d4ff; color: #000; }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; gap: 16px; text-align: center; }
            .authors-grid { grid-template-columns: 1fr; }
            .analytics-grid { grid-template-columns: 1fr; }
            .modal-content { width: 95%; margin: 10% auto; }
            
            /* Mobile table handling */
            .performance-table {
                overflow-x: auto;
            }
            
            .analytics-table {
                min-width: 600px;
            }
            
            .analytics-table th,
            .analytics-table td {
                padding: 2px 8px !important;
                font-size: 13px;
            }
        }
    </style>
</body>
</html> 