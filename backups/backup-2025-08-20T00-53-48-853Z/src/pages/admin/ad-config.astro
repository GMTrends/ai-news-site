---
/**
 * Ad Configuration Manager - Admin interface for managing strategic ad placements
 * Centralized control panel for optimizing revenue and avoiding ad-blocker detection
 */

import { adManager } from '../../lib/ad-manager.ts';
import RevenueAnalytics from '../../components/RevenueAnalytics.astro';

const activeSlots = adManager.getActiveSlots();
const revenueProjection = adManager.getRevenueProjection();

// Mock performance data
const performanceData = {
  'premium-sidebar-1': { revenue: 850, ctr: 2.4, impressions: 35400 },
  'premium-sidebar-2': { revenue: 580, ctr: 2.1, impressions: 27600 },
  'article-banner-top': { revenue: 620, ctr: 1.8, impressions: 34500 },
  'article-content-middle': { revenue: 420, ctr: 1.5, impressions: 28000 }
};
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Content Placement Manager - AI Buzz Media</title>
  <meta name="robots" content="noindex, nofollow">
</head>
<body>
  <div class="admin-container">
    <header class="admin-header">
      <div class="header-content">
        <h1>üéØ Strategic Content Placement Manager</h1>
        <div class="header-stats">
          <div class="stat-item">
            <span class="stat-value">${revenueProjection.total.toLocaleString()}</span>
            <span class="stat-label">Monthly Target</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{activeSlots.length}</span>
            <span class="stat-label">Active Placements</span>
          </div>
        </div>
      </div>
    </header>

    <section class="analytics-section">
      <RevenueAnalytics showDetailedMetrics={true} />
    </section>

    <section class="slot-management">
      <div class="section-header">
        <h2>Content Placement Configuration</h2>
        <button class="btn-primary" id="add-placement">+ Add New Placement</button>
      </div>

      <div class="slots-grid">
        {activeSlots.map(slot => {
          const performance = performanceData[slot.id as keyof typeof performanceData] || {};
          const revenue = performance.revenue || 0;
          const ctr = performance.ctr || 0;
          const impressions = performance.impressions || 0;
          
          return (
            <div class="slot-card" data-slot-id={slot.id}>
              <div class="slot-header">
                <div class="slot-info">
                  <h3 class="slot-name">{slot.name}</h3>
                  <span class={`slot-priority priority-${slot.priority}`}>{slot.priority.toUpperCase()}</span>
                </div>
                <div class="slot-controls">
                  <button class="btn-edit" data-action="edit">‚úèÔ∏è</button>
                  <button class="btn-toggle" data-action="toggle">
                    {slot.isActive ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                  </button>
                </div>
              </div>

              <div class="slot-metrics">
                <div class="metric">
                  <span class="metric-value">${revenue}</span>
                  <span class="metric-label">Revenue</span>
                </div>
                <div class="metric">
                  <span class="metric-value">{ctr}%</span>
                  <span class="metric-label">CTR</span>
                </div>
                <div class="metric">
                  <span class="metric-value">{impressions.toLocaleString()}</span>
                  <span class="metric-label">Impressions</span>
                </div>
              </div>

              <div class="slot-details">
                <div class="detail-row">
                  <span class="detail-label">Size:</span>
                  <span class="detail-value">{slot.size}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Position:</span>
                  <span class="detail-value">{slot.position}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">CPM Range:</span>
                  <span class="detail-value">{slot.cpmRange}</span>
                </div>
              </div>

              <div class="slot-targeting">
                <span class="targeting-label">Targeting:</span>
                <div class="targeting-tags">
                  {slot.targeting.map(tag => (
                    <span class="targeting-tag">{tag}</span>
                  ))}
                </div>
              </div>

              <div class="slot-actions">
                <button class="btn-optimize" data-slot-id={slot.id}>üöÄ Optimize</button>
                <button class="btn-test" data-slot-id={slot.id}>üß™ A/B Test</button>
              </div>
            </div>
          );
        })}
      </div>
    </section>

    <section class="optimization-tools">
      <div class="section-header">
        <h2>Revenue Optimization Tools</h2>
      </div>

      <div class="tools-grid">
        <div class="tool-card">
          <div class="tool-header">
            <h3>üìà CPM Optimizer</h3>
            <span class="tool-status active">Active</span>
          </div>
          <div class="tool-content">
            <p>Automatically adjusts targeting and positioning to maximize CPM rates.</p>
            <div class="tool-metrics">
              <span class="improvement">+23% CPM increase</span>
              <span class="timeframe">Last 30 days</span>
            </div>
            <button class="tool-action">Configure Settings</button>
          </div>
        </div>

        <div class="tool-card">
          <div class="tool-header">
            <h3>üõ°Ô∏è Blocker Evasion</h3>
            <span class="tool-status active">Active</span>
          </div>
          <div class="tool-content">
            <p>Dynamic class names and terminology to avoid detection.</p>
            <div class="tool-metrics">
              <span class="improvement">97% visibility rate</span>
              <span class="timeframe">Current</span>
            </div>
            <button class="tool-action">Update Terms</button>
          </div>
        </div>
      </div>
    </section>

    <section class="quick-actions">
      <div class="section-header">
        <h2>Quick Actions</h2>
      </div>

      <div class="actions-grid">
        <button class="action-btn revenue-boost">
          <span class="action-icon">üöÄ</span>
          <span class="action-text">Revenue Boost Mode</span>
          <span class="action-desc">Activate high-CPM placements</span>
        </button>

        <button class="action-btn emergency-disable">
          <span class="action-icon">‚èπÔ∏è</span>
          <span class="action-text">Emergency Disable</span>
          <span class="action-desc">Disable all placements instantly</span>
        </button>
      </div>
    </section>
  </div>

  <script is:inline>
    document.addEventListener('DOMContentLoaded', function() {
      // Slot management functionality
      const slotCards = document.querySelectorAll('.slot-card');
      slotCards.forEach(function(card) {
        const slotId = card.getAttribute('data-slot-id');
        
        const toggleBtn = card.querySelector('[data-action="toggle"]');
        if (toggleBtn) {
          toggleBtn.addEventListener('click', function() {
            const isActive = toggleBtn.textContent && toggleBtn.textContent.trim() === '‚è∏Ô∏è';
            if (toggleBtn.textContent) {
              toggleBtn.textContent = isActive ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
            }
            card.classList.toggle('inactive', isActive);
            console.log((isActive ? 'Disabled' : 'Enabled') + ' slot: ' + slotId);
          });
        }

        const optimizeBtn = card.querySelector('.btn-optimize');
        if (optimizeBtn) {
          optimizeBtn.addEventListener('click', function() {
            console.log('Optimizing slot: ' + slotId);
            showNotification('Optimization started for slot: ' + slotId, 'info');
          });
        }
      });

      // Quick actions
      const revenueBoostBtn = document.querySelector('.revenue-boost');
      if (revenueBoostBtn) {
        revenueBoostBtn.addEventListener('click', function() {
          console.log('Activating revenue boost mode');
          showNotification('Revenue boost mode activated!', 'success');
        });
      }

      const emergencyDisableBtn = document.querySelector('.emergency-disable');
      if (emergencyDisableBtn) {
        emergencyDisableBtn.addEventListener('click', function() {
          if (confirm('Are you sure you want to disable all placements?')) {
            console.log('Disabling all placements');
            showNotification('All placements disabled', 'warning');
          }
        });
      }

      function showNotification(message, type) {
        type = type || 'info';
        const notification = document.createElement('div');
        notification.className = 'notification ' + type;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(function() { notification.classList.add('show'); }, 100);
        setTimeout(function() {
          notification.classList.remove('show');
          setTimeout(function() { 
            if (notification.parentNode) {
              document.body.removeChild(notification); 
            }
          }, 300);
        }, 3000);
      }
    });
  </script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #0a0a0b; color: #fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .admin-container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    
    .admin-header { background: rgba(26, 26, 27, 0.95); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 16px; padding: 24px; margin-bottom: 32px; }
    .header-content { display: flex; justify-content: space-between; align-items: center; }
    .admin-header h1 { font-size: 28px; font-weight: 700; color: #00d4ff; }
    .header-stats { display: flex; gap: 32px; }
    .stat-item { text-align: center; }
    .stat-value { display: block; font-size: 24px; font-weight: 700; color: #00d4ff; }
    .stat-label { display: block; font-size: 14px; color: rgba(255, 255, 255, 0.7); margin-top: 4px; }
    
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .section-header h2 { font-size: 22px; font-weight: 600; color: #fff; }
    
    .btn-primary { background: linear-gradient(90deg, #00d4ff, #0099cc); color: #000; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
    .btn-primary:hover { background: linear-gradient(90deg, #0099cc, #007399); transform: translateY(-1px); }
    
    .slots-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 24px; }
    .slot-card { background: rgba(26, 26, 27, 0.95); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; transition: all 0.3s ease; }
    .slot-card:hover { border-color: rgba(0, 212, 255, 0.3); transform: translateY(-2px); }
    .slot-card.inactive { opacity: 0.6; }
    
    .slot-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
    .slot-name { font-size: 18px; font-weight: 600; color: #fff; margin: 0 0 8px 0; }
    .slot-priority { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
    .priority-premium { background: rgba(255, 107, 53, 0.1); color: #ff6b35; }
    .priority-high { background: rgba(0, 212, 255, 0.1); color: #00d4ff; }
    
    .slot-controls { display: flex; gap: 8px; }
    .btn-edit, .btn-toggle { background: rgba(255, 255, 255, 0.1); border: none; padding: 8px; border-radius: 6px; cursor: pointer; }
    
    .slot-metrics { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 16px; }
    .metric { text-align: center; }
    .metric-value { display: block; font-size: 18px; font-weight: 700; color: #00d4ff; }
    .metric-label { display: block; font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-top: 4px; }
    
    .slot-details { margin-bottom: 16px; }
    .detail-row { display: flex; justify-content: space-between; margin-bottom: 8px; }
    .detail-label { color: rgba(255, 255, 255, 0.7); font-size: 14px; }
    .detail-value { color: #fff; font-size: 14px; font-weight: 500; }
    
    .slot-targeting { margin-bottom: 16px; }
    .targeting-label { color: rgba(255, 255, 255, 0.7); font-size: 14px; display: block; margin-bottom: 8px; }
    .targeting-tags { display: flex; flex-wrap: wrap; gap: 6px; }
    .targeting-tag { background: rgba(0, 212, 255, 0.1); color: #00d4ff; padding: 4px 8px; border-radius: 6px; font-size: 12px; }
    
    .slot-actions { display: flex; gap: 12px; }
    .btn-optimize, .btn-test { flex: 1; background: rgba(255, 255, 255, 0.1); color: #fff; border: none; padding: 10px; border-radius: 6px; font-size: 12px; cursor: pointer; }
    
    .tools-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
    .tool-card { background: rgba(26, 26, 27, 0.95); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; }
    .tool-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .tool-status.active { background: rgba(34, 197, 94, 0.1); color: #22c55e; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; }
    .improvement { color: #22c55e; font-weight: 600; }
    .tool-action { background: rgba(0, 212, 255, 0.1); color: #00d4ff; border: 1px solid rgba(0, 212, 255, 0.2); padding: 10px 16px; border-radius: 6px; cursor: pointer; width: 100%; }
    
    .actions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; }
    .action-btn { background: rgba(26, 26, 27, 0.95); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; cursor: pointer; text-align: left; }
    .action-icon { font-size: 24px; display: block; margin-bottom: 8px; }
    .action-text { color: #fff; font-size: 16px; font-weight: 600; display: block; margin-bottom: 4px; }
    .action-desc { color: rgba(255, 255, 255, 0.7); font-size: 13px; }
    
    .notification { position: fixed; top: 20px; right: 20px; padding: 12px 20px; border-radius: 8px; color: #fff; z-index: 1000; transform: translateX(100%); transition: transform 0.3s ease; }
    .notification.show { transform: translateX(0); }
    .notification.success { background: #22c55e; }
    .notification.warning { background: #f7931e; }
    .notification.info { background: #00d4ff; color: #000; }
  </style>
</body>
</html>
