---
// TEST Newsletter subscription - Minimal version
---

<section style="padding: 2rem; background: #1a1a1a; color: white;">
    <h2>Newsletter Test</h2>
    
    <div id="testForm" style="margin: 2rem 0;">
        <input 
            type="email" 
            id="testEmail"
            placeholder="Enter email"
            style="padding: 0.5rem; margin-right: 1rem; border: 1px solid #ccc; border-radius: 4px;"
        />
        <button 
            id="testButton"
            style="padding: 0.5rem 1rem; background: #0066ff; color: white; border: none; border-radius: 4px; cursor: pointer;"
        >
            Test Subscribe
        </button>
    </div>
    
    <div id="testMessage" style="margin-top: 1rem; padding: 1rem; display: none; border-radius: 4px;"></div>
</section>

<script>
console.log('TEST SCRIPT LOADED');

document.addEventListener('DOMContentLoaded', function() {
    console.log('TEST DOM LOADED');
    
    const button = document.getElementById('testButton');
    const input = document.getElementById('testEmail');
    const message = document.getElementById('testMessage');
    
    console.log('Elements found:', { button: !!button, input: !!input, message: !!message });
    
    if (button) {
        button.addEventListener('click', function(e) {
            console.log('TEST BUTTON CLICKED - Event object:', e);
            console.log('Event prevented:', e.defaultPrevented);
            
            e.preventDefault();
            e.stopPropagation();
            
            const email = input ? input.value.trim() : '';
            console.log('Email value:', email);
            
            if (message) {
                message.style.display = 'block';
                message.style.background = '#22c55e';
                message.style.color = 'white';
                message.textContent = 'TEST: Button clicked successfully! Email: ' + email;
            }
            
            // Test the API call
            if (email) {
                testAPICall(email);
            }
            
            return false;
        });
    }
    
    async function testAPICall(email) {
        console.log('Testing API call with email:', email);
        
        try {
            const response = await fetch('/api/subscribe', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email: email })
            });
            
            console.log('API Response status:', response.status);
            console.log('API Response headers:', [...response.headers.entries()]);
            
            const data = await response.json();
            console.log('API Response data:', data);
            
            if (message) {
                message.textContent = 'API Response: ' + JSON.stringify(data);
            }
            
        } catch (error) {
            console.error('API Error:', error);
            if (message) {
                message.style.background = '#ef4444';
                message.textContent = 'API Error: ' + error.message;
            }
        }
    }
});
</script>
