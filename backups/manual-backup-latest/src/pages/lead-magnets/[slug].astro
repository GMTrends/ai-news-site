---
export const prerender = false;

interface Props {
  slug: string;
}

const { slug } = Astro.props;
const url = new URL(Astro.request.url);
const token = url.searchParams.get('token');
const email = url.searchParams.get('email');
const source = url.searchParams.get('source');

// Validate token and email
if (!token || !email) {
  return Astro.redirect('/404');
}

// Lead magnet configurations
const leadMagnets = {
  'ai-tools-roi-calculator.xlsx': {
    title: 'AI Tools ROI Calculator + Performance Matrix',
    description: 'Compare 50+ AI tools with real performance data and calculate potential ROI for your business.',
    fileUrl: '/assets/lead-magnets/ai-tools-roi-calculator.xlsx',
    category: 'general'
  },
  'ai-agents-automation-guide.pdf': {
    title: 'AI Agents Automation Guide',
    description: 'Complete guide to AI agents, automation workflows, and business applications.',
    fileUrl: '/assets/lead-magnets/ai-agents-automation-guide.pdf',
    category: 'ai-agents'
  },
  'business-ai-roi-calculator.xlsx': {
    title: 'Business AI ROI Calculator',
    description: 'Calculate ROI for AI tools in your business with real case studies and benchmarks.',
    fileUrl: '/assets/lead-magnets/business-ai-roi-calculator.xlsx',
    category: 'business'
  },
  'ai-coding-tools-comparison.pdf': {
    title: 'AI Coding Tools Comparison Guide',
    description: 'Compare the best AI coding tools with performance metrics and use cases.',
    fileUrl: '/assets/lead-magnets/ai-coding-tools-comparison.pdf',
    category: 'productivity'
  },
  'creative-ai-workflow-guide.pdf': {
    title: 'Creative AI Workflow Guide',
    description: 'Optimize your creative workflow with AI tools and automation.',
    fileUrl: '/assets/lead-magnets/creative-ai-workflow-guide.pdf',
    category: 'creative'
  },
  'ecommerce-ai-strategy.pdf': {
    title: 'E-commerce AI Strategy Guide',
    description: 'Boost your e-commerce business with AI-powered strategies and tools.',
    fileUrl: '/assets/lead-magnets/ecommerce-ai-strategy.pdf',
    category: 'ecommerce'
  },
  'marketing-ai-tools-guide.pdf': {
    title: 'Marketing AI Tools Guide',
    description: 'Discover the best AI tools for marketing and automation.',
    fileUrl: '/assets/lead-magnets/marketing-ai-tools-guide.pdf',
    category: 'marketing'
  }
};

const leadMagnet = leadMagnets[slug as keyof typeof leadMagnets];

if (!leadMagnet) {
  return Astro.redirect('/404');
}

// Log the download for analytics
console.log('Lead magnet download:', {
  slug,
  email,
  source,
  token,
  timestamp: new Date().toISOString(),
  userAgent: Astro.request.headers.get('user-agent')
});
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{leadMagnet.title} - AI Buzz Media</title>
  <meta name="description" content={leadMagnet.description}>
  
  <!-- Open Graph -->
  <meta property="og:title" content={leadMagnet.title}>
  <meta property="og:description" content={leadMagnet.description}>
  <meta property="og:type" content="website">
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .download-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 2rem;
      text-align: center;
      background: rgba(30, 41, 59, 0.8);
      border-radius: 20px;
      border: 1px solid rgba(59, 130, 246, 0.2);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    
    .download-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, #00d4ff 0%, #0066ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .download-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: #f8fafc;
    }
    
    .download-description {
      font-size: 1.1rem;
      line-height: 1.6;
      margin-bottom: 2rem;
      color: #cbd5e1;
    }
    
    .download-button {
      display: inline-block;
      background: linear-gradient(135deg, #00d4ff 0%, #0066ff 100%);
      color: white;
      padding: 1rem 2rem;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 16px rgba(0, 212, 255, 0.3);
    }
    
    .download-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 212, 255, 0.4);
    }
    
    .download-info {
      margin-top: 2rem;
      padding: 1rem;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 8px;
      font-size: 0.9rem;
      color: #94a3b8;
    }
    
    .back-link {
      margin-top: 2rem;
      display: block;
      color: #60a5fa;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    
    .back-link:hover {
      color: #00d4ff;
    }
    
    @media (max-width: 768px) {
      .download-container {
        margin: 1rem;
        padding: 1.5rem;
      }
      
      .download-title {
        font-size: 1.5rem;
      }
      
      .download-description {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="download-container">
    <div class="download-icon">üìä</div>
    <h1 class="download-title">{leadMagnet.title}</h1>
    <p class="download-description">{leadMagnet.description}</p>
    
    <a href={leadMagnet.fileUrl} class="download-button" download>
      Download Now
    </a>
    
    <div class="download-info">
      <p>‚úÖ Your download will start automatically</p>
      <p>üìß Check your email for additional resources</p>
      <p>üîí Your information is secure and private</p>
    </div>
    
    <a href="/" class="back-link">‚Üê Back to AI Buzz Media</a>
  </div>
  
  <script is:inline>
    // Track the download
    if (typeof window.gtag !== 'undefined') {
      window.gtag('event', 'lead_magnet_download', {
        'event_category': 'engagement',
        'event_label': '{slug}',
        'custom_parameter': '{email}'
      });
    }
    
    // Auto-download after a short delay
    setTimeout(() => {
      const downloadLink = document.querySelector('.download-button');
      if (downloadLink && downloadLink instanceof HTMLAnchorElement) {
        downloadLink.click();
      }
    }, 2000);
  </script>
</body>
</html> 