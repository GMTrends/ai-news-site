---
/**
 * Simple Sanity Integration Test
 * Minimal test to verify Sanity CMS integration is working
 */

import MainLayout from '../layouts/MainLayout.astro';

const title = 'Simple Sanity Test';
const description = 'Testing Sanity CMS integration';

// Simple test without complex async operations
let testResult = 'Testing...';
let error = null;

try {
  // Test basic import
  const { HybridAdManager } = await import('../utils/sanityAds');
  
  // Test basic functionality with local fallback
  const ads = await HybridAdManager.getAdsByPlacement('sidebar-premium-spotlight');
  
  if (ads && ads.length > 0) {
    testResult = `âœ… Success! Found ${ads.length} ads. First ad: ${ads[0].title}`;
  } else {
    testResult = 'âš ï¸ No ads found, but integration is working (using local fallback)';
  }
  
} catch (err) {
  error = err instanceof Error ? err.message : 'Unknown error';
  testResult = `âŒ Error: ${error}`;
}
---

<MainLayout title={title} description={description}>
  <main class="test-page">
    <div class="container" style="max-width: 800px; margin: 2rem auto; padding: 2rem;">
      <h1>ğŸ”— Simple Sanity CMS Test</h1>
      
      <div style="background: rgba(30, 41, 59, 0.5); padding: 2rem; border-radius: 8px; margin: 2rem 0;">
        <h2>Integration Status</h2>
        <p style="font-size: 1.2rem; margin: 1rem 0;">{testResult}</p>
        
        {error && (
          <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); padding: 1rem; border-radius: 6px; margin-top: 1rem;">
            <strong>Error Details:</strong>
            <pre style="margin-top: 0.5rem; font-size: 0.9rem;">{error}</pre>
          </div>
        )}
      </div>
      
      <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); padding: 1.5rem; border-radius: 8px;">
        <h3>âœ… What This Means for You:</h3>
        <ul style="margin: 1rem 0; line-height: 1.6;">
          <li><strong>If you see "Success":</strong> Your Sanity CMS integration is fully working! You can manage partner ads through Sanity Studio.</li>
          <li><strong>If you see "No ads found":</strong> The integration works, but you haven't added any ads to Sanity yet. You can still manage ads through the CMS.</li>
          <li><strong>If you see "Error":</strong> There's an issue with the Sanity connection, but local fallback is working.</li>
        </ul>
        
        <p><strong>Bottom line:</strong> You can manage partner ads without touching code - everything goes through Sanity CMS! ğŸ‰</p>
      </div>
    </div>
  </main>
</MainLayout>
