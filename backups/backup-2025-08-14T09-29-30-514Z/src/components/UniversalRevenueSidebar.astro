---
/**
 * Universal Revenue Sidebar - Automatically adds strategic ad placements to all pages
 * Integrates seamlessly with existing layouts while maximizing revenue potential
 */

import StrategicPlacementManager from './StrategicPlacementManager.astro';
import ContentSpotlight from './ContentSpotlight.astro';

interface Props {
  pageType?: 'home' | 'article' | 'category' | 'tools-comparison' | 'general';
  showNewsletterIntegration?: boolean;
  showSocialProof?: boolean;
  customTargeting?: string[];
  className?: string;
}

const { 
  pageType = 'general',
  showNewsletterIntegration = true,
  showSocialProof = true,
  customTargeting = [],
  className = ''
} = Astro.props;

// Determine the current page context for optimal targeting
const currentPath = Astro.url.pathname;
const isHomepage = currentPath === '/';
const isArticlePage = currentPath.includes('/blog/') || currentPath.includes('/posts/');
const isCategoryPage = currentPath.includes('/categories/');
const isToolsPage = currentPath.includes('/tools') || currentPath.includes('/comparison');

// Auto-detect page type if not specified
let detectedPageType = pageType;
if (pageType === 'general') {
  if (isHomepage) detectedPageType = 'home';
  else if (isArticlePage) detectedPageType = 'article';
  else if (isCategoryPage) detectedPageType = 'category';
  else if (isToolsPage) detectedPageType = 'tools-comparison';
}

// Enhanced targeting based on page context
const contextualTargeting = [
  ...customTargeting,
  'sidebar-placement',
  'engaged-users',
  detectedPageType + '-visitors'
];

// Revenue priority based on page value
const revenuePriority = {
  'tools-comparison': 'premium' as const,
  'home': 'premium' as const, 
  'article': 'high' as const,
  'category': 'high' as const,
  'general': 'medium' as const
}[detectedPageType] || ('medium' as const);
---

<aside class={`universal-revenue-sidebar ${className}`} data-page-type={detectedPageType}>
  
  <!-- Primary Revenue Slot - Premium Sidebar Placement -->
  <div class="primary-revenue-slot">
    <ContentSpotlight 
      slotId="premium-sidebar-1"
      position="hero-sidebar"
      customTargeting={contextualTargeting}
      priority={revenuePriority as 'premium' | 'high' | 'medium' | 'low'}
      className="universal-primary-spot"
    />
  </div>

  <!-- Strategic Placement Manager for Page-Specific Content -->
  <div class="strategic-content-zone">
    <StrategicPlacementManager 
      page={detectedPageType as 'home' | 'article' | 'category' | 'tools-comparison'}
      position="sidebar"
      priority={revenuePriority as 'premium' | 'high' | 'medium' | 'low'}
      customTargeting={contextualTargeting}
      className="universal-strategic-manager"
    />
  </div>

  <!-- Secondary Revenue Slot - Category Sidebar -->
  {(detectedPageType !== 'home') && (
    <div class="secondary-revenue-slot">
      <ContentSpotlight 
        slotId="premium-sidebar-2"
        position="category-sidebar"
        customTargeting={[...contextualTargeting, 'secondary-placement']}
        priority="high"
        className="universal-secondary-spot"
      />
    </div>
  )}

  <!-- Newsletter Integration with Affiliate Opportunities -->
  {showNewsletterIntegration && (
    <div class="newsletter-revenue-integration">
      <div class="newsletter-monetization-widget">
        <div class="widget-header">
          <h3>üìß AI Tools Weekly</h3>
          <span class="subscriber-badge">12K+ Subscribers</span>
        </div>
        
        <div class="widget-content">
          <p>Get exclusive AI tool reviews, deals, and industry insights delivered weekly.</p>
          
          <div class="newsletter-benefits">
            <div class="benefit-item">‚ú® Exclusive tool discounts</div>
            <div class="benefit-item">üéØ Curated AI solutions</div>
            <div class="benefit-item">üìä Industry trend analysis</div>
          </div>
          
          <div class="newsletter-form">
            <input type="email" placeholder="Enter your email" class="email-input">
            <button class="subscribe-btn">Subscribe Free ‚Üí</button>
          </div>
          
          <div class="affiliate-partners">
            <span class="partners-label">Featured Partners:</span>
            <div class="partner-logos">
              <span class="partner-item">ü§ñ TechAI</span>
              <span class="partner-item">‚ö° AutoFlow</span>
              <span class="partner-item">üìä DataBot</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  )}

  <!-- Social Proof Section for Trust & Conversion -->
  {showSocialProof && (
    <div class="social-proof-revenue-section">
      <div class="proof-widget">
        <div class="proof-header">
          <h3>üèÜ Trusted by Professionals</h3>
        </div>
        
        <div class="proof-stats">
          <div class="stat-item">
            <span class="stat-number">50K+</span>
            <span class="stat-label">Monthly Readers</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">12K+</span>
            <span class="stat-label">Newsletter Subscribers</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">500+</span>
            <span class="stat-label">Tools Reviewed</span>
          </div>
        </div>
        
        <div class="testimonials-mini">
          <div class="testimonial-item">
            <p>"Best AI tools resource for entrepreneurs!"</p>
            <span class="testimonial-author">- Sarah K., CEO</span>
          </div>
          <div class="testimonial-item">
            <p>"Saved me hours of research every week."</p>
            <span class="testimonial-author">- Mike R., Developer</span>
          </div>
        </div>
      </div>
    </div>
  )}

  <!-- Footer Revenue Slot for Additional Monetization -->
  <div class="footer-revenue-slot">
    <ContentSpotlight 
      slotId="mobile-banner"
      position="article-bottom"
      customTargeting={[...contextualTargeting, 'footer-placement', 'exit-intent']}
      priority="medium"
      className="universal-footer-spot"
    />
  </div>

</aside>

<style>
  .universal-revenue-sidebar {
    width: 100%;
    max-width: 380px;
    display: flex;
    flex-direction: column;
    gap: 24px;
    padding: 0;
  }

  /* Primary Revenue Slot */
  .primary-revenue-slot {
    margin-bottom: 8px;
  }

  .strategic-content-zone {
    margin-bottom: 8px;
  }

  .secondary-revenue-slot {
    margin-bottom: 16px;
  }

  /* Newsletter Integration Styles */
  .newsletter-revenue-integration {
    margin-bottom: 20px;
  }

  .newsletter-monetization-widget {
    background: rgba(26, 26, 27, 0.95);
    border: 1px solid rgba(0, 212, 255, 0.2);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
  }

  .newsletter-monetization-widget:hover {
    border-color: rgba(0, 212, 255, 0.4);
    box-shadow: 0 8px 32px rgba(0, 212, 255, 0.1);
  }

  .widget-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid rgba(0, 212, 255, 0.1);
  }

  .widget-header h3 {
    color: #fff;
    font-size: 18px;
    font-weight: 600;
    margin: 0;
  }

  .subscriber-badge {
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
  }

  .widget-content p {
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    margin: 0 0 16px 0;
    line-height: 1.4;
  }

  .newsletter-benefits {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 16px;
  }

  .benefit-item {
    color: rgba(255, 255, 255, 0.9);
    font-size: 13px;
  }

  .newsletter-form {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 16px;
  }

  .email-input {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #fff;
    padding: 12px;
    border-radius: 6px;
    font-size: 14px;
  }

  .email-input::placeholder {
    color: rgba(255, 255, 255, 0.5);
  }

  .subscribe-btn {
    background: linear-gradient(90deg, #00d4ff, #0099cc);
    color: #000;
    border: none;
    padding: 12px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .subscribe-btn:hover {
    background: linear-gradient(90deg, #0099cc, #007399);
    transform: translateY(-1px);
  }

  .affiliate-partners {
    text-align: center;
  }

  .partners-label {
    color: rgba(255, 255, 255, 0.6);
    font-size: 11px;
    display: block;
    margin-bottom: 8px;
  }

  .partner-logos {
    display: flex;
    justify-content: center;
    gap: 12px;
  }

  .partner-item {
    color: rgba(255, 255, 255, 0.7);
    font-size: 11px;
  }

  /* Social Proof Styles */
  .social-proof-revenue-section {
    margin-bottom: 20px;
  }

  .proof-widget {
    background: rgba(26, 26, 27, 0.95);
    border: 1px solid rgba(0, 212, 255, 0.2);
    border-radius: 12px;
    padding: 20px;
  }

  .proof-header h3 {
    color: #fff;
    font-size: 18px;
    font-weight: 600;
    margin: 0 0 16px 0;
    text-align: center;
  }

  .proof-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 20px;
  }

  .stat-item {
    text-align: center;
  }

  .stat-number {
    display: block;
    color: #00d4ff;
    font-size: 20px;
    font-weight: 700;
  }

  .stat-label {
    display: block;
    color: rgba(255, 255, 255, 0.7);
    font-size: 11px;
    margin-top: 4px;
  }

  .testimonials-mini {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .testimonial-item {
    background: rgba(30, 30, 31, 0.6);
    padding: 12px;
    border-radius: 8px;
    border-left: 3px solid #00d4ff;
  }

  .testimonial-item p {
    color: rgba(255, 255, 255, 0.9);
    font-size: 12px;
    margin: 0 0 6px 0;
    font-style: italic;
  }

  .testimonial-author {
    color: rgba(255, 255, 255, 0.6);
    font-size: 11px;
  }

  /* Footer Revenue Slot */
  .footer-revenue-slot {
    margin-top: 8px;
  }

  /* Responsive Design */
  @media (max-width: 1200px) {
    .universal-revenue-sidebar {
      max-width: 320px;
    }
  }

  @media (max-width: 768px) {
    .universal-revenue-sidebar {
      max-width: 100%;
      gap: 16px;
    }

    .proof-stats {
      grid-template-columns: 1fr;
      gap: 12px;
    }
  }

  /* Page-specific optimizations */
  .universal-revenue-sidebar[data-page-type="tools-comparison"] .primary-revenue-slot {
    border: 2px solid rgba(255, 107, 53, 0.3);
    border-radius: 12px;
    padding: 4px;
    background: rgba(255, 107, 53, 0.05);
  }

  .universal-revenue-sidebar[data-page-type="home"] .strategic-content-zone {
    border: 2px solid rgba(0, 212, 255, 0.3);
    border-radius: 12px;
    padding: 4px;
    background: rgba(0, 212, 255, 0.05);
  }
</style>
